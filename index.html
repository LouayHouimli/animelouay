<!DOCTYPE html>
<html>
<head>
    <title>Anime Search</title>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>
<body>
    <h1>Anime Search</h1>
    <form id="searchForm" action="">
        <input type="text" id="animeSearch" name="q" placeholder="Search for anime..." oninput="searchAnime()">
    </form>

    <div id="searchResults">
        <!-- Search results will be displayed here -->
    </div>

    <script>
        var currentSearchQuery = '';
        var displayedIDs = new Set();
        var animeSearchInput = document.getElementById("animeSearch");

        // Clear input value when the page is refreshed
        animeSearchInput.value = '';

        function searchAnime() {
            var query = animeSearchInput.value.trim();
            var searchResults = document.getElementById("searchResults");

            if (query === currentSearchQuery) {
                return; // Avoid duplicated fetch
            }

            currentSearchQuery = query;
            displayedIDs.clear(); // Clear the set of displayed IDs

            // Clear previous search results
            searchResults.innerHTML = '';

            if (query === '') {
                return; // No need to fetch if the query is empty
            }

           fetch(`https://api.consumet.org/anime/gogoanime/${query}`)
    .then(response => response.json())
    .then(data => {
        // Display anime titles and genres with links from fetched data
        data.results.forEach(function(anime) {
            if (!displayedIDs.has(anime.id)) {
                // Fetch additional details including genres and total episodes
                fetch(`https://api.consumet.org/anime/gogoanime/info/${anime.id}`)
                    .then(response => response.json())
                    .then(infoData => {
                        var animeDiv = document.createElement("div");
                        animeDiv.innerHTML = `
                            <h2><a href="anime.html?id=${anime.id}&genres=${JSON.stringify(infoData.genres)}&totalEpisodes=${infoData.totalEpisodes || ''}">${anime.title}</a></h2>
                            <img src="${anime.image}" alt="${anime.title}" style="max-width: 200px;">
                         
                            <p>${infoData.totalEpisodes !== undefined ? `Total Episodes: ${infoData.totalEpisodes}` : "Total Episodes: N/A"}</p>
                        `;
                        searchResults.appendChild(animeDiv);

                        displayedIDs.add(anime.id);
                    })
                    .catch(error => {
                        console.error('Error fetching additional anime info:', error);
                    });
            }
        });
    })
    .catch(error => {
        console.error('Error fetching data:', error);
    });

        }
    </script>
</body>
</html>
